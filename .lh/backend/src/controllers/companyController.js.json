{
    "sourceFile": "backend/src/controllers/companyController.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1765550616080,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765551320237,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,88 +0,0 @@\n-import pool from \"../models/db.js\";\r\n-import sanitizeHtml from \"sanitize-html\";\r\n-import cloudinary from \"../config/cloudinaryConfig.js\";\r\n-import createError from \"http-errors\";\r\n-\r\n-const sanitize = (text) => (text ? sanitizeHtml(text) : null);\r\n-\r\n-export const createOrUpdateProfile = async (req, res, next) => {\r\n-  try {\r\n-    const ownerId = req.user.id;\r\n-    const {\r\n-      company_name, address, city, state, country, postal_code,\r\n-      website, industry, founded_date, description, social_links\r\n-    } = req.body;\r\n-\r\n-    // sanitize inputs\r\n-    const sCompany = sanitize(company_name);\r\n-    const sAddress = sanitize(address);\r\n-\r\n-    // check if profile exists\r\n-    const existing = await pool.query(\"SELECT id FROM company_profile WHERE owner_id=$1\", [ownerId]);\r\n-\r\n-    if (existing.rows.length === 0) {\r\n-      const insertQ = `\r\n-        INSERT INTO company_profile (owner_id, company_name, address, city, state, country, postal_code, website, industry, founded_date, description, social_links)\r\n-        VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12)\r\n-        RETURNING *`;\r\n-      const values = [ownerId, sCompany, sAddress, city, state, country, postal_code, website || null, industry, founded_date || null, description || null, social_links ? JSON.stringify(social_links) : null];\r\n-      const { rows } = await pool.query(insertQ, values);\r\n-      return res.status(201).json({ success:true, profile: rows[0] });\r\n-    } else {\r\n-      const updateQ = `\r\n-        UPDATE company_profile SET\r\n-          company_name=$1, address=$2, city=$3, state=$4, country=$5, postal_code=$6,\r\n-          website=$7, industry=$8, founded_date=$9, description=$10, social_links=$11\r\n-        WHERE owner_id=$12\r\n-        RETURNING *`;\r\n-      const values = [sCompany, sAddress, city, state, country, postal_code, website || null, industry, founded_date || null, description || null, social_links ? JSON.stringify(social_links) : null, ownerId];\r\n-      const { rows } = await pool.query(updateQ, values);\r\n-      return res.json({ success:true, profile: rows[0] });\r\n-    }\r\n-  } catch (err) {\r\n-    next(err);\r\n-  }\r\n-};\r\n-\r\n-export const getProfile = async (req, res, next) => {\r\n-  try {\r\n-    const ownerId = req.user.id;\r\n-    const { rows } = await pool.query(\"SELECT * FROM company_profile WHERE owner_id=$1\", [ownerId]);\r\n-    if (rows.length === 0) return res.status(404).json({ message: \"Profile not found\" });\r\n-    return res.json({ profile: rows[0] });\r\n-  } catch (err) {\r\n-    next(err);\r\n-  }\r\n-};\r\n-\r\n-export const uploadImage = async (req, res, next) => {\r\n-  try {\r\n-    // req.file or req.files expected (we'll accept base64 or multipart)\r\n-    if (!req.files && !req.body.image) {\r\n-      return res.status(400).json({ message: \"Image is required\" });\r\n-    }\r\n-\r\n-    // accept base64 payload or multipart file\r\n-    let uploadResult;\r\n-    if (req.body.image) {\r\n-      // base64 string\r\n-      uploadResult = await cloudinary.uploader.upload(req.body.image, { folder: `company_${req.user.id}` });\r\n-    } else if (req.files && req.files.file) {\r\n-      // if using express-fileupload or multer, adapt accordingly. Sample:\r\n-      const tempPath = req.files.file.tempFilePath;\r\n-      uploadResult = await cloudinary.uploader.upload(tempPath, { folder: `company_${req.user.id}` });\r\n-    } else {\r\n-      return res.status(400).json({ message: \"Unsupported upload format\" });\r\n-    }\r\n-\r\n-    // update relevant column\r\n-    const { type } = req.query; // ?type=logo or ?type=banner\r\n-    const column = type === \"banner\" ? \"banner_url\" : \"logo_url\";\r\n-    const query = `UPDATE company_profile SET ${column}=$1 WHERE owner_id=$2 RETURNING *`;\r\n-    const { rows } = await pool.query(query, [uploadResult.secure_url, req.user.id]);\r\n-\r\n-    return res.json({ success:true, url: uploadResult.secure_url, profile: rows[0] });\r\n-  } catch (err) {\r\n-    next(err);\r\n-  }\r\n-};\r\n\\ No newline at end of file\n"
                }
            ],
            "date": 1765550616080,
            "name": "Commit-0",
            "content": "import pool from \"../models/db.js\";\r\nimport sanitizeHtml from \"sanitize-html\";\r\nimport cloudinary from \"../config/cloudinaryConfig.js\";\r\nimport createError from \"http-errors\";\r\n\r\nconst sanitize = (text) => (text ? sanitizeHtml(text) : null);\r\n\r\nexport const createOrUpdateProfile = async (req, res, next) => {\r\n  try {\r\n    const ownerId = req.user.id;\r\n    const {\r\n      company_name, address, city, state, country, postal_code,\r\n      website, industry, founded_date, description, social_links\r\n    } = req.body;\r\n\r\n    // sanitize inputs\r\n    const sCompany = sanitize(company_name);\r\n    const sAddress = sanitize(address);\r\n\r\n    // check if profile exists\r\n    const existing = await pool.query(\"SELECT id FROM company_profile WHERE owner_id=$1\", [ownerId]);\r\n\r\n    if (existing.rows.length === 0) {\r\n      const insertQ = `\r\n        INSERT INTO company_profile (owner_id, company_name, address, city, state, country, postal_code, website, industry, founded_date, description, social_links)\r\n        VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12)\r\n        RETURNING *`;\r\n      const values = [ownerId, sCompany, sAddress, city, state, country, postal_code, website || null, industry, founded_date || null, description || null, social_links ? JSON.stringify(social_links) : null];\r\n      const { rows } = await pool.query(insertQ, values);\r\n      return res.status(201).json({ success:true, profile: rows[0] });\r\n    } else {\r\n      const updateQ = `\r\n        UPDATE company_profile SET\r\n          company_name=$1, address=$2, city=$3, state=$4, country=$5, postal_code=$6,\r\n          website=$7, industry=$8, founded_date=$9, description=$10, social_links=$11\r\n        WHERE owner_id=$12\r\n        RETURNING *`;\r\n      const values = [sCompany, sAddress, city, state, country, postal_code, website || null, industry, founded_date || null, description || null, social_links ? JSON.stringify(social_links) : null, ownerId];\r\n      const { rows } = await pool.query(updateQ, values);\r\n      return res.json({ success:true, profile: rows[0] });\r\n    }\r\n  } catch (err) {\r\n    next(err);\r\n  }\r\n};\r\n\r\nexport const getProfile = async (req, res, next) => {\r\n  try {\r\n    const ownerId = req.user.id;\r\n    const { rows } = await pool.query(\"SELECT * FROM company_profile WHERE owner_id=$1\", [ownerId]);\r\n    if (rows.length === 0) return res.status(404).json({ message: \"Profile not found\" });\r\n    return res.json({ profile: rows[0] });\r\n  } catch (err) {\r\n    next(err);\r\n  }\r\n};\r\n\r\nexport const uploadImage = async (req, res, next) => {\r\n  try {\r\n    // req.file or req.files expected (we'll accept base64 or multipart)\r\n    if (!req.files && !req.body.image) {\r\n      return res.status(400).json({ message: \"Image is required\" });\r\n    }\r\n\r\n    // accept base64 payload or multipart file\r\n    let uploadResult;\r\n    if (req.body.image) {\r\n      // base64 string\r\n      uploadResult = await cloudinary.uploader.upload(req.body.image, { folder: `company_${req.user.id}` });\r\n    } else if (req.files && req.files.file) {\r\n      // if using express-fileupload or multer, adapt accordingly. Sample:\r\n      const tempPath = req.files.file.tempFilePath;\r\n      uploadResult = await cloudinary.uploader.upload(tempPath, { folder: `company_${req.user.id}` });\r\n    } else {\r\n      return res.status(400).json({ message: \"Unsupported upload format\" });\r\n    }\r\n\r\n    // update relevant column\r\n    const { type } = req.query; // ?type=logo or ?type=banner\r\n    const column = type === \"banner\" ? \"banner_url\" : \"logo_url\";\r\n    const query = `UPDATE company_profile SET ${column}=$1 WHERE owner_id=$2 RETURNING *`;\r\n    const { rows } = await pool.query(query, [uploadResult.secure_url, req.user.id]);\r\n\r\n    return res.json({ success:true, url: uploadResult.secure_url, profile: rows[0] });\r\n  } catch (err) {\r\n    next(err);\r\n  }\r\n};\r\n"
        }
    ]
}